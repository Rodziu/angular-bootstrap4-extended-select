<!--
  ~ AngularJS extended select component.
  ~ Copyright (c) 2016-2019 Rodziu <mateusz.rohde@gmail.com>
  ~ License: MIT
  -->
<div class="dropdown custom-select angular-extended-select" bs-dropdown="ctrl.isOpen"
	 ng-class="{'custom-select-sm': ctrl.isSmall, 'custom-select-lg': ctrl.isLarge}" ng-disabled="ctrl.isDisabled" ng-readonly="ctrl.isReadonly">
	<span class="caret"></span>
	<ul class="extended-select-multiple">
		<li ng-show="!ctrl.ngModel.length && !ctrl.isOpen">
			{{ctrl.placeholder}}
		</li>
		<li ng-repeat="m in ctrl.ngModel" class="ext-select-choice" ng-if="ctrl.getModelValue(m)">
			<span>{{::ctrl.getModelValue(m)}}</span>
			<button type="button" class="close" ng-click="$event.stopPropagation();ctrl.deselect(m)"
					ng-if="!ctrl.isDisabled && !ctrl.isReadonly">&times;</button>
		</li>
		<li ng-show="ctrl.isOpen">
			<input type="text" ng-model="ctrl.search" extended-select-search ng-change="ctrl.searchFn()"
				   ng-disabled="attr.disabled"/>
			<a ng-click="$event.stopPropagation();ctrl.addOptionAction()" class="label label-success"
			   ng-show="ctrl.addOption && ctrl.search">{{::ctrl.addOptionLang}}</a>
		</li>
	</ul>
	<div class="clearfix"></div>
	<div class="dropdown-menu" extended-select-dropdown ng-hide="!ctrl.typeToSearch && !ctrl.options.length">
		<ul class="dropdown-menu" extended-select-options="ctrl.activeIndex">
			<li class="dropdown-item" ng-repeat="o in ctrl.optionsFiltered =
				(ctrl.options | extendedSelectFilter:ctrl.search:ctrl.typeToSearch:ctrl.searchByValue)"
				ng-click="ctrl.pickOption(o)"
				ng-class="{'active': $index == ctrl.activeIndex, 'selected': ctrl.isSelected(o)}">
				<a ng-bind-html="o.label | extendedSelectSearch:ctrl.search"></a>
			</li>
			<li class="dropdown-item" ng-show="ctrl.typeToSearch && ctrl.search.length < ctrl.typeToSearch">
				<a>{{::ctrl.typeToSearchText}}</a>
			</li>
			<li class="dropdown-item" ng-show="ctrl.resolveOnSearch && ctrl.hasNextPage">
				<a class="text-primary" ng-click="ctrl.searchFn(ctrl.page + 1)">{{::ctrl.loadMoreResultsLang}}</a>
			</li>
		</ul>
	</div>
	<div ng-transclude style="display:none"></div>
</div>
