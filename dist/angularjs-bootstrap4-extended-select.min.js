angular.module("extendedSelect",["angularBS.helpers","angularBS.dropdown"]),function(){"use strict";function e(e){angular.forEach(["ngOptions","select"],function(t){e.decorator(t+"Directive",["$delegate",function(e){return angular.forEach(e,function(e){const t=e.compile||function(){};e.compile=function(l){if("EXTENDED-SELECT"!==l[0].tagName)return t.apply(this,arguments)||e.link}}),e}])})}e.$inject=["$provide"],angular.module("extendedSelect").config(e)}(),function(){"use strict";angular.module("extendedSelect").provider("extendedSelect",function(){this.options={placeholder:" ",placeholderMultiple:" ",typeToSearch:0,typeToSearchText:"Zacznij pisać, by wyświetlić dostępne opcje",addOptionLang:"Dodaj",loadMoreResultsLang:"Pobierz więcej wyników",searchByValue:!1},this.$get=function(){return this.options}})}(),function(){"use strict";angular.module("extendedSelect").directive("esTransclude",function(){return{restrict:"A",require:"^extendedSelect",link:function(e,t,l,s,i){(l.esTransclude?[l.esTransclude]:["optionTemplate","beforeOption"]).forEach(l=>{i.isSlotFilled(l)&&i((i,n)=>{n.$extendedSelect=s,n.$option=e.o,n.$isOption=!0,angular.isUndefined(e.o)&&(n.$isOption=!1,s.multiple?n.$option={value:e.m,label:s.getModelLabel(e.m)}:n.$watch(()=>s.ngModel,()=>{n.$option={value:s.ngModel,label:s.getModelLabel()}})),"optionTemplate"===l?t.contents().replaceWith(i):t.prepend(i)},null,l)})}}})}(),function(){"use strict";function e(e){const t=this;function l(){t._search=t.extendedSelect.search;let l=t.label;t.label&&angular.isString(t._search)&&t._search.length&&(l=t.label.replace(new RegExp("("+t._search+")","gi"),"<u>$1</u>")),e.html(l)}t.$doCheck=function(){t.extendedSelect.search!==t._search&&l()},t.$onChanges=function(){l()}}e.$inject=["$element"],angular.module("extendedSelect").component("extendedSelectMarkResult",{require:{extendedSelect:"^extendedSelect"},bindings:{label:"<"},controllerAs:"vm",controller:e})}(),function(){"use strict";angular.module("extendedSelect").directive("extendedSelectOptions",function(){return{restrict:"A",bindToController:{activeIndex:"<extendedSelectOptions"},controller:["$element","angularBS",function(e,t){const l=this;l.$onChanges=function(){const s=e[0].querySelector(`.dropdown-item:nth-child(${l.activeIndex+1})`);if(null===s)return;const i=s.offsetTop,n=e[0].scrollTop,a=t.offset(s).height+i,c=t.offset(e[0]).height;n-i>0?e[0].scrollTop=i:n-a<-1*c&&(e[0].scrollTop=a-c)}}]}})}(),function(){"use strict";function e(e){return{restrict:"A",require:"^extendedSelect",link:function(t,l,s,i){e.has("$animate")&&e.get("$animate").enabled(l,!1),l[0].focus(),l.on("keydown",function(e){if(e.stopPropagation(),!i.optionsFiltered.length)return void(13===e.which&&(i.addOptionAction(),i.$scope.$apply()));const t=i.activeIndex;switch(e.which){case 40:do{if(i.activeIndex++,i.activeIndex>=i.optionsFiltered.length){i.activeIndex=t;break}}while(i.multiple&&i.isSelected(i.optionsFiltered[i.activeIndex]));break;case 38:do{if(i.activeIndex--,i.activeIndex<0){i.activeIndex=t;break}}while(i.multiple&&i.isSelected(i.optionsFiltered[i.activeIndex]));break;case 13:if(angular.isDefined(i.optionsFiltered[i.activeIndex]))return i.pickOption(i.optionsFiltered[i.activeIndex]),void i.$scope.$apply()}i.$scope.$digest()})}}}e.$inject=["$injector"],angular.module("extendedSelect").directive("extendedSelectSearch",e)}(),function(){"use strict";class e{constructor(e,t,l,s,i,n,a){this.$element=e,this.$attrs=t,this.$scope=l,this.$timeout=s,this.$transclude=i,this.extendedSelectOptions=n,this.extendedSelect=a,this._ngOptions="ngOptions"in t?n.parseNgOptions(t.ngOptions):null,this._searchTimeout=null}$onInit(){this.options=[],this.optionsFiltered=[],this.activeIndex=-1,this.search="",this.multiple="multiple"in this.$attrs,!this.deselectable&&"deselectable"in this.$attrs&&!this.$attrs.deselectable.length&&(this.deselectable=!0),this.addOptionLang=this.extendedSelect.addOptionLang,this.loadMoreResultsLang=this.extendedSelect.loadMoreResultsLang,this.typeToSearchText=this.extendedSelect.typeToSearchText,angular.isUndefined(this.typeToSearch)&&(this.typeToSearch=this.extendedSelect.typeToSearch),angular.isUndefined(this.searchByValue)&&(this.searchByValue=this.extendedSelect.searchByValue),angular.isUndefined(this.placeholder)&&(this.placeholder="multiple"in this.$attrs?this.extendedSelect.placeholderMultiple:this.extendedSelect.placeholder),this.multiple&&(this.ngModelCtrl.$isEmpty=function(e){return!e||0===e.length}),this.$attrs.$observe("placeholder",e=>{this.placeholder=e}),this.$attrs.$observe("disabled",e=>{this.isDisabled=!0===e||angular.isString(e)}),this.$attrs.$observe("readonly",e=>{this.isReadonly=!0===e||angular.isString(e)})}$doCheck(){const e=[];let t;if(this.$transclude(t=>{angular.forEach(t,t=>{e.push({value:t.value,label:t.textContent})})},null,"option"),null!==this._ngOptions){this._ngOptions.valuesFn(this.$scope.$parent).forEach((l,s)=>{const i=this._ngOptions.getLocals(s,l);e.push({value:this._ngOptions.valueFn(this.$scope.$parent,i),label:this._ngOptions.displayFn(this.$scope.$parent,i)}),this._addOptionCalled&&e[e.length-1].label===this.search&&(t=e[e.length-1],this._addOptionCalled=!1)})}angular.equals(e,this.options)||(this.options=e,t&&this.pickOption(t),this.filterData()),this.isSmall=this.$element.hasClass("custom-select-sm"),this.isLarge=this.$element.hasClass("custom-select-lg")}open(){const e=this.isOpen;this.ngModelCtrl.$setTouched(),this.isDisabled||this.isReadonly?this.isOpen=!1:this.isOpen=!!this.multiple||!this.isOpen,!e&&this.isOpen&&(this.search="",this.activeIndex=-1,this.options.some((e,t)=>{if(this.isSelected(e)&&(this.activeIndex=t,!this.multiple))return!0}),this.filterData())}_updateMultipleModel(e,t){const l=[];this.options.forEach(s=>{!this.isSelected(s)&&!angular.equals(s.value,e)||angular.equals(s.value,t)||l.push(s.value)}),angular.equals(this.ngModel,l)||(this.ngModel=l)}filterData(){if(angular.isUndefined(this.search))return void angular.copy(this.options,this.optionsFiltered);if(angular.copy([],this.optionsFiltered),this.search.length<this.typeToSearch)return;const e=this.search.toLowerCase();this.options.forEach(t=>{(~t.label.toLowerCase().indexOf(e)||this.searchByValue&&~t.value.toLowerCase().indexOf(e))&&this.optionsFiltered.push(t)})}isSelected(e){return!angular.isUndefined(this.ngModel)&&(this.multiple?!!~this.ngModel.indexOf(e.value):angular.equals(e.value,this.ngModel))}getModelLabel(e){angular.isUndefined(e)&&(e=this.ngModel);const t=this.options.find(t=>angular.equals(t.value,e));return t?t.label:""}searchFn(e){if(angular.isUndefined(e)&&(this.activeIndex=this.options.length?0:-1),this.hasNextPage=!1,this.filterData(),angular.isFunction(this.resolveOnSearch)&&(this.page=e||1,angular.isDefined(this.search)&&this.search.length)){const e=angular.isUndefined(this._lastSearchValue)?0:750;null!==this._searchTimeout&&this.$timeout.cancel(this._searchTimeout),this._lastSearchValue=this.search,this.loading=!0,this._searchTimeout=this.$timeout(()=>{this._searchTimeout=null,this.resolveOnSearch({value:this.search,page:this.page}).then(e=>{this._lastSearchValue=void 0,this.loading=!1,this.hasNextPage=e&&!!e.hasNextPage,this.filterData()}).catch(angular.noop)},e)}}pickOption(e){this.multiple?(angular.isUndefined(this.ngModel)&&(this.ngModel=[]),~this.ngModel.indexOf(e.value)||this._updateMultipleModel(e.value),this.activeIndex=-1,this.search=""):(this.isOpen=!1,this.ngModel=e.value,this.activeIndex=this.options.indexOf(e)),this.hasNextPage=!1,this.ngModelCtrl.$setViewValue(this.ngModel)}deselect(e){this.multiple?this._updateMultipleModel(void 0,e):this.ngModel=void 0,this.activeIndex=-1,this.ngModelCtrl.$setViewValue(this.ngModel)}addOptionAction(){if(angular.isFunction(this.addOption)&&this.search.length){const e=this.options.find(e=>e.label===this.search);e?this.pickOption(e):(this.addOption({value:this.search}),this._addOptionCalled=!0)}}}e.$inject=["$element","$attrs","$scope","$timeout","$transclude","extendedSelectOptions","extendedSelect"],angular.module("extendedSelect").component("extendedSelect",{require:{ngModelCtrl:"ngModel"},bindings:{ngModel:"=",addOption:"&?",resolveOnSearch:"&?",deselectable:"<?",typeToSearch:"<?",searchByValue:"<?"},transclude:{option:"?option",beforeOption:"?beforeOption",optionTemplate:"?optionTemplate"},templateUrl:"src/templates/extended-select.html",controllerAs:"ctrl",controller:e})}(),function(){"use strict";t.$inject=["$parse"];const e=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([$\w][$\w]*)|(?:\(\s*([$\w][$\w]*)\s*,\s*([$\w][$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/;function t(t){return{parseNgOptions:function(l){const s=l.match(e);if(null===s)return null;const i=s[5]||s[7],n=s[6];return{valueFn:t(s[2]?s[1]:i),displayFn:t(s[2]||s[1]),valuesFn:t(s[8]),getLocals:function(e,t){const l={};return l[i]=t,n&&(l[n]=e),l}}}}}angular.module("extendedSelect").factory("extendedSelectOptions",t)}(),angular.module("extendedSelect").run(["$templateCache",function(e){e.put("src/templates/extended-select.html",'<div class="dropdown custom-select angular-extended-select" bs-dropdown="ctrl.isOpen" ng-click="ctrl.open()" ng-class="{\'custom-select-sm\': ctrl.isSmall, \'custom-select-lg\': ctrl.isLarge}" ng-disabled="ctrl.isDisabled" ng-readonly="ctrl.isReadonly"><div class="d-flex flex-row-reverse align-items-center" ng-if="::!ctrl.multiple"><div class="d-flex"><div ng-show="ctrl.loading" class="flex-fill pl-1"><i class="fa fa-spinner fa-spin"></i></div><a class="text-success flex-fill pl-1" ng-click="$event.stopPropagation();ctrl.addOptionAction()" ng-if="ctrl.addOption && ctrl.search" title="{{::ctrl.addOptionLang}}"><i class="fa fa-plus"></i></a> <a class="text-danger flex-fill pl-1" ng-click="ctrl.deselect()" ng-if="ctrl.deselectable && ctrl.getModelLabel() && !ctrl.isDisabled && !ctrl.isReadonly"><i class="fa fa-times"></i></a></div><div class="d-flex flex-grow-1 align-items-center" es-transclude="beforeOption"><div ng-show="!ctrl.isOpen" class="text-nowrap" ng-switch="ctrl.ngModelCtrl.$isEmpty(ctrl.ngModel)"><span ng-switch-when="true" class="text-nowrap placeholder">{{ctrl.placeholder}}</span> <span ng-switch-default es-transclude="optionTemplate">{{ctrl.getModelLabel()}}</span></div><input ng-if="ctrl.isOpen" class="flex-grow-1" type="text" ng-model="ctrl.search" ng-change="ctrl.searchFn()" placeholder="{{ctrl.getModelLabel() || ctrl.placeholder}}" extended-select-search></div></div><div class="d-flex flex-row-reverse align-items-center" ng-if="::ctrl.multiple"><div class="d-flex"><div ng-show="ctrl.loading" class="flex-fill pl-1"><i class="fa fa-spinner fa-spin"></i></div></div><div class="d-flex flex-grow-1 flex-wrap"><div ng-if="!ctrl.ngModel.length && !ctrl.isOpen" class="text-nowrap placeholder">{{ctrl.placeholder}}</div><div class="d-flex extended-select-choice" ng-repeat="m in ctrl.ngModel" ng-if="ctrl.getModelLabel(m)"><span class="d-flex" es-transclude>{{::ctrl.getModelLabel(m)}}</span> <button type="button" class="close pl-1" ng-click="$event.stopPropagation();ctrl.deselect(m)" ng-if="!ctrl.isDisabled && !ctrl.isReadonly"><i class="fa fa-times"></i></button></div><input ng-if="ctrl.isOpen" class="flex-grow-1" type="text" ng-model="ctrl.search" ng-change="ctrl.searchFn()" placeholder="{{ctrl.ngModel.length ? \'\': ctrl.placeholder}}" extended-select-search> <a class="text-success" ng-click="$event.stopPropagation();ctrl.addOptionAction()" ng-if="ctrl.addOption && ctrl.search" title="{{::ctrl.addOptionLang}}"><i class="fa fa-plus"></i></a></div></div><div class="dropdown-menu" ng-click="$event.stopPropagation()" ng-hide="!ctrl.typeToSearch && !ctrl.options.length" extended-select-options="ctrl.activeIndex"><a href="javascript:" class="dropdown-item d-flex align-items-center" ng-repeat="o in ctrl.optionsFiltered" ng-click="ctrl.pickOption(o)" ng-class="{active: $index == ctrl.activeIndex, selected: ctrl.isSelected(o)}" es-transclude><extended-select-mark-result label="o.label"></extended-select-mark-result></a> <span class="dropdown-item-text" ng-show="ctrl.typeToSearch && ctrl.search.length < ctrl.typeToSearch">{{::ctrl.typeToSearchText}}</span> <a href="javascript:" class="dropdown-item text-primary" ng-show="ctrl.resolveOnSearch && ctrl.hasNextPage && (!ctrl.typeToSearch || ctrl.search.length >= ctrl.typeToSearch)" ng-click="ctrl.searchFn(ctrl.page + 1)">{{::ctrl.loadMoreResultsLang}}</a></div></div>')}]);
//# sourceMappingURL=angularjs-bootstrap4-extended-select.min.js.map
