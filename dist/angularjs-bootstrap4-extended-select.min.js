!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("angular"),require("angularjs-bootstrap-4")):"function"==typeof define&&define.amd?define("angularjs-bootstrap4-extended-select",["angular","angularjs-bootstrap-4"],t):"object"==typeof exports?exports["angularjs-bootstrap4-extended-select"]=t(require("angular"),require("angularjs-bootstrap-4")):e["angularjs-bootstrap4-extended-select"]=t(e.angular,e["angularjs-bootstrap-4"])}(window,(function(e,t){return(()=>{"use strict";var s={734:t=>{t.exports=e},635:e=>{e.exports=t}},i={};function l(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return s[e](n,n.exports,l),n.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var s in t)l.o(t,s)&&!l.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={};return(()=>{l.d(n,{default:()=>h});var e=l(734),t=l(635),s=l.n(t);const i=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?)(?:\s+nested\s+by\s+([\s\S]+?))?)?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([$\w][$\w]*)|(?:\(\s*([$\w][$\w]*)\s*,\s*([$\w][$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/;class o{constructor(e,t,s,i,l,n,o){this.$element=e,this.$attrs=t,this.$scope=s,this.$timeout=i,this.$transclude=l,this.extendedSelectOptions=n,this.extendedSelect=o,this.options=[],this.optionsFiltered=[],this.activeIndex=-1,this.search="",this._searchTimeout=null,this._transcludedOptions=[],this._ngOptions="ngOptions"in t?n.parseNgOptions(t.ngOptions):null,this.multiple="multiple"in this.$attrs,this.placeholder="multiple"in this.$attrs?this.extendedSelect.placeholderMultiple:this.extendedSelect.placeholder}$onInit(){this.deselectable||!("deselectable"in this.$attrs)||this.$attrs.deselectable.length||(this.deselectable=!0),this.addOptionLang=this.extendedSelect.addOptionLang,this.loadMoreResultsLang=this.extendedSelect.loadMoreResultsLang,this.typeToSearchText=this.extendedSelect.typeToSearchText,e.isUndefined(this.typeToSearch)&&(this.typeToSearch=this.extendedSelect.typeToSearch),e.isUndefined(this.searchByValue)&&(this.searchByValue=this.extendedSelect.searchByValue),this.multiple&&(this.ngModelCtrl.$isEmpty=function(e){return!e||0===e.length}),this._transcludedOptions=[],this.$transclude((t=>{e.forEach(t,(e=>{this._transcludedOptions.push({value:e.value,label:e.textContent})}))}),null,"option"),this.$attrs.$observe("placeholder",(e=>{this.placeholder=e})),this.$attrs.$observe("disabled",(t=>{this.isDisabled=!0===t||e.isString(t)})),this.$attrs.$observe("readonly",(t=>{this.isReadonly=!0===t||e.isString(t)}))}$doCheck(){if(this.isSmall=this.$element.hasClass("custom-select-sm"),this.isLarge=this.$element.hasClass("custom-select-lg"),null!==this._ngOptions){const t=this._ngOptions.valuesFn(this.$scope.$parent);e.isDefined(t)&&!e.equals(t,this._optionObjects)&&(this._optionObjects=e.copy(t),this.updateOptions(t))}}updateOptions(t){const s=e.copy(this._transcludedOptions),i=[],l=[],n=(t,s)=>{e.isDefined(s)&&n(s);let l=i.find((e=>e.name===t));return e.isUndefined(l)?(l={name:t,parentGroup:s,children:[]},i.push(l)):e.isDefined(s)&&l.parentGroup!==s&&(l.parentGroup=s),l};let o;if(t.forEach(((t,i)=>{const l=this._ngOptions.getLocals(i,t),a=this._ngOptions.groupByFn(this.$scope.$parent,l),r=this._ngOptions.nestedByFn(this.$scope.$parent,l);s.push({value:this._ngOptions.valueFn(this.$scope.$parent,l),label:this._ngOptions.displayFn(this.$scope.$parent,l),group:e.isDefined(a)?n(a,r):void 0}),this._addOptionCalled&&s[s.length-1].label===this.search&&(o=s[s.length-1],this._addOptionCalled=!1)})),i.length){i.forEach((t=>{let s,n;e.isUndefined(t.parentGroup)?n=l:(s=i.find((e=>e.name===t.parentGroup)),n=s.children),t.parent=s,n.push(t)}));const t=[],n=(e,s=0)=>{e.forEach((e=>{t.push(e.name),e.level=s,n(e.children,s+1)}))};n(l),s.sort(((e,s)=>t.indexOf(e.group.name)-t.indexOf(s.group.name)))}this.options=s,o&&this.pickOption(o),this.filterData()}open(){const e=this.isOpen;this.ngModelCtrl.$setTouched(),this.isDisabled||this.isReadonly?this.isOpen=!1:this.isOpen=!!this.multiple||!this.isOpen,!e&&this.isOpen&&(this.search="",this.activeIndex=-1,this.options.some(((e,t)=>{if(this.isSelected(e)&&(this.activeIndex=t,!this.multiple))return!0})),this.filterData())}_updateMultipleModel(t,s){const i=[];this.options.forEach((l=>{!this.isSelected(l)&&!e.equals(l.value,t)||e.equals(l.value,s)||i.includes(l.value)||i.push(l.value)})),e.equals(this.ngModel,i)||(this.ngModel=i)}filterData(){if(e.isUndefined(this.search))return void e.copy(this.options,this.optionsFiltered);if(e.copy([],this.optionsFiltered),this.search.length<this.typeToSearch)return;const t=this.search.toLowerCase();this.options.forEach((s=>{(s.label.toLowerCase().includes(t)||this.searchByValue&&(e.isString(s.value)&&s.value.toLowerCase().includes(t)||e.isObject(s.value)&&e.toJson(s.value).toLowerCase().includes(t)))&&this.optionsFiltered.push(s)}))}isSelected(t){return!e.isUndefined(this.ngModel)&&(this.multiple?this.ngModel.includes(t.value):e.equals(t.value,this.ngModel))}getModelLabel(t){e.isUndefined(t)&&(t=this.ngModel);const s=this.options.find((s=>e.equals(s.value,t)));return s?s.label:""}searchFn(t){if(e.isUndefined(t)&&(this.activeIndex=this.options.length?0:-1),this.hasNextPage=!1,this.filterData(),e.isFunction(this.resolveOnSearch)&&(this.page=t||1,e.isDefined(this.search)&&this.search.length)){const t=e.isUndefined(this._lastSearchValue)?0:750;null!==this._searchTimeout&&this.$timeout.cancel(this._searchTimeout),this._lastSearchValue=this.search,this.loading=!0,this._searchTimeout=this.$timeout((()=>{this._searchTimeout=null,this.resolveOnSearch({value:this.search,page:this.page}).then((e=>{this._lastSearchValue=void 0,this.loading=!1,this.hasNextPage=e&&!!e.hasNextPage,this.filterData()})).catch(e.noop)}),t)}}pickOption(t){this.multiple?(e.isUndefined(this.ngModel)&&(this.ngModel=[]),this.ngModel.includes(t.value)||this._updateMultipleModel(t.value),this.activeIndex=-1,this.search=""):(this.isOpen=!1,this.ngModel=t.value,this.activeIndex=this.options.indexOf(t)),this.hasNextPage=!1,this.ngModelCtrl.$setViewValue(this.ngModel)}deselect(e){this.multiple?this._updateMultipleModel(void 0,e):this.ngModel=this.deselectValue,this.activeIndex=-1,this.ngModelCtrl.$setViewValue(this.ngModel)}addOptionAction(){if(e.isFunction(this.addOption)&&this.search.length){const e=this.options.find((e=>e.label===this.search));e?this.pickOption(e):(this.addOption({value:this.search}),this._addOptionCalled=!0)}}}o.$inject=["$element","$attrs","$scope","$timeout","$transclude","extendedSelectOptions","extendedSelect"];const a={require:{ngModelCtrl:"ngModel"},bindings:{ngModel:"=",addOption:"&?",resolveOnSearch:"&?",deselectable:"<?",deselectValue:"<?",typeToSearch:"<?",searchByValue:"<?"},transclude:{option:"?option",beforeOption:"?beforeOption",optionTemplate:"?optionTemplate"},template:'<div class="dropdown custom-select angular-extended-select" bs-dropdown="ctrl.isOpen" ng-click="ctrl.open()" ng-class="{\'custom-select-sm\': ctrl.isSmall, \'custom-select-lg\': ctrl.isLarge}" ng-disabled="ctrl.isDisabled" ng-readonly="ctrl.isReadonly"><div class="d-flex flex-row-reverse align-items-center" ng-if="::!ctrl.multiple"><div class="d-flex"><div ng-show="ctrl.loading" class="flex-fill pl-1"><i class="fa fa-spinner fa-spin"></i></div><a class="text-success flex-fill pl-1" ng-click="$event.stopPropagation();ctrl.addOptionAction()" ng-if="ctrl.addOption && ctrl.search" title="{{::ctrl.addOptionLang}}"><i class="fa fa-plus"></i></a> <a class="text-danger flex-fill pl-1" ng-click="ctrl.deselect()" ng-if="ctrl.deselectable && ctrl.getModelLabel() && !ctrl.isDisabled && !ctrl.isReadonly"><i class="fa fa-times"></i></a></div><div class="d-flex flex-grow-1 align-items-center" es-transclude="beforeOption"><div ng-show="!ctrl.isOpen" class="text-nowrap" ng-switch="ctrl.ngModelCtrl.$isEmpty(ctrl.ngModel)"><span ng-switch-when="true" class="text-nowrap placeholder">{{ctrl.placeholder}}</span> <span ng-switch-default es-transclude="optionTemplate">{{ctrl.getModelLabel()}}</span></div><input ng-if="ctrl.isOpen" class="flex-grow-1" type="text" ng-model="ctrl.search" ng-change="ctrl.searchFn()" placeholder="{{ctrl.getModelLabel() || ctrl.placeholder}}" extended-select-search></div></div><div class="d-flex flex-row-reverse align-items-center" ng-if="::ctrl.multiple"><div class="d-flex"><div ng-show="ctrl.loading" class="flex-fill pl-1"><i class="fa fa-spinner fa-spin"></i></div></div><div class="d-flex flex-grow-1 flex-wrap"><div ng-if="!ctrl.ngModel.length && !ctrl.isOpen" class="text-nowrap placeholder">{{ctrl.placeholder}}</div><div class="d-flex extended-select-choice" ng-repeat="m in ctrl.ngModel" ng-if="ctrl.getModelLabel(m)"><span class="d-flex" es-transclude>{{::ctrl.getModelLabel(m)}}</span> <button type="button" class="close pl-1" ng-click="$event.stopPropagation();ctrl.deselect(m)" ng-if="!ctrl.isDisabled && !ctrl.isReadonly"><i class="fa fa-times"></i></button></div><input ng-if="ctrl.isOpen" class="flex-grow-1" type="text" ng-model="ctrl.search" ng-change="ctrl.searchFn()" placeholder="{{ctrl.ngModel.length ? \'\': ctrl.placeholder}}" extended-select-search> <a class="text-success" ng-click="$event.stopPropagation();ctrl.addOptionAction()" ng-if="ctrl.addOption && ctrl.search" title="{{::ctrl.addOptionLang}}"><i class="fa fa-plus"></i></a></div></div><div class="dropdown-menu" ng-click="$event.stopPropagation()" ng-hide="!ctrl.typeToSearch && !ctrl.options.length" extended-select-options="ctrl.activeIndex"><div ng-repeat="o in ctrl.optionsFiltered"><extended-select-option-group group="o.group" prev-group="ctrl.optionsFiltered[$index - 1].group" ng-if="o.group && ($first || ctrl.optionsFiltered[$index - 1].group !== o.group)"></extended-select-option-group><a href="javascript:" class="dropdown-item d-flex align-items-center" ng-style="::o.group ? {\'padding-left\': 10 + ((o.group.level + 1) * 10) + \'px\'} : {}" ng-click="ctrl.pickOption(o)" ng-class="{active: $index == ctrl.activeIndex, selected: ctrl.isSelected(o)}" es-transclude><extended-select-mark-result label="o.label"></extended-select-mark-result></a></div><span class="dropdown-item-text" ng-show="ctrl.typeToSearch && ctrl.search.length < ctrl.typeToSearch">{{::ctrl.typeToSearchText}}</span> <a href="javascript:" class="dropdown-item text-primary" ng-show="ctrl.resolveOnSearch && ctrl.hasNextPage && (!ctrl.typeToSearch || ctrl.search.length >= ctrl.typeToSearch)" ng-click="ctrl.searchFn(ctrl.page + 1)">{{::ctrl.loadMoreResultsLang}}</a></div></div>',controllerAs:"ctrl",controller:o},r={require:{extendedSelect:"^extendedSelect"},bindings:{label:"<"},controllerAs:"vm",controller:class{constructor(e){this.$element=e}$doCheck(){this.extendedSelect.search!==this._search&&this._update()}$onChanges(){this._update()}_update(){this._search=this.extendedSelect.search;let t=this.label;this.label&&e.isString(this._search)&&this._search.length&&(t=this.label.replace(new RegExp("("+this._search+")","gi"),"<u>$1</u>")),this.$element.html(t)}}},c={controller:class{$onChanges(){this.groups=[this.group];let t=this.group;for(;e.isDefined(t.parent);){if(t=t.parent,e.isDefined(this.prevGroup)){let e=this.prevGroup;if(e.level>t.level&&(e=this.getUntilLevel(e,t.level)),e.name===t.name)break}this.groups.unshift(t)}}getUntilLevel(e,t){for(;e.level>t;)e=e.parent;return e}},controllerAs:"vm",bindings:{group:"<",prevGroup:"<"},template:'<h6 class="dropdown-header" ng-repeat="group in vm.groups" ng-style="::{\'padding-left\': 10 + (group.level * 10) + \'px\'}">{{::group.name}}</h6>'};class d{constructor(e,t){this.$element=e,this.angularBS=t}$onChanges(){const e=this.$element[0].querySelector(`.dropdown-item:nth-child(${this.activeIndex+1})`);if(null===e)return;const t=e.offsetTop,s=this.$element[0].scrollTop,i=this.angularBS.offset(e).height+t,l=this.angularBS.offset(this.$element[0]).height;s-t>0?this.$element[0].scrollTop=t:s-i<-1*l&&(this.$element[0].scrollTop=i-l)}}d.$inject=["$element","angularBS"];const h=e.module("extendedSelect",[s()]).provider("extendedSelect",class{constructor(){this.options={placeholder:" ",placeholderMultiple:" ",typeToSearch:0,typeToSearchText:"Begin typing to display available options",addOptionLang:"Add",loadMoreResultsLang:"Load more results",searchByValue:!1}}$get(){return this.options}}).config((function(t){e.forEach(["ngOptions","select"],(function(s){t.decorator(s+"Directive",["$delegate",function(t){return e.forEach(t,(function(t){const s=t.compile||e.noop;t.compile=function(e,i,l){if("EXTENDED-SELECT"!==e[0].tagName)return s.apply(this,[e,i,l])||t.link;t.terminal=!1}})),t}])}))})).factory("extendedSelectOptions",class{constructor(e){this.$parse=e}parseNgOptions(e){const t=e.match(i);if(null===t)return null;const s=t[6]||t[8],l=t[7];return{valueFn:this.$parse(t[2]?t[1]:s),displayFn:this.$parse(t[2]||t[1]),groupByFn:this.$parse(t[3]||""),nestedByFn:this.$parse(t[4]||""),valuesFn:this.$parse(t[9]),getLocals:(e,t)=>{const i={};return i[s]=t,l&&(i[l]=e),i}}}}).component("extendedSelect",a).directive("esTransclude",(function(){return{restrict:"A",require:"^extendedSelect",link:function(t,s,i,l,n){(i.esTransclude?[i.esTransclude]:["optionTemplate","beforeOption"]).forEach((i=>{n.isSlotFilled(i)&&n(((n,o)=>{o.$extendedSelect=l,o.$option=t.o,o.$isOption=!0,e.isUndefined(t.o)&&(o.$isOption=!1,l.multiple?o.$option={value:t.m,label:l.getModelLabel(t.m)}:o.$watch((()=>l.ngModel),(()=>{o.$option={value:l.ngModel,label:l.getModelLabel()}}))),"optionTemplate"===i?s.contents().replaceWith(n):s.prepend(n)}),null,i)}))}}})).component("extendedSelectMarkResult",r).component("extendedSelectOptionGroup",c).directive("extendedSelectOptions",(function(){return{restrict:"A",bindToController:{activeIndex:"<extendedSelectOptions"},controller:d}})).directive("extendedSelectSearch",(function(t){return{restrict:"A",require:"^extendedSelect",link:function(s,i,l,n){t.has("$animate")&&t.get("$animate").enabled(i,!1),i[0].focus(),i.on("keydown",(function(t){if(t.stopPropagation(),!n.optionsFiltered.length)return void(13===t.which&&(n.addOptionAction(),n.$scope.$apply()));const s=n.activeIndex;switch(t.which){case 40:do{if(n.activeIndex++,n.activeIndex>=n.optionsFiltered.length){n.activeIndex=s;break}}while(n.multiple&&n.isSelected(n.optionsFiltered[n.activeIndex]));break;case 38:do{if(n.activeIndex--,n.activeIndex<0){n.activeIndex=s;break}}while(n.multiple&&n.isSelected(n.optionsFiltered[n.activeIndex]));break;case 13:if(e.isDefined(n.optionsFiltered[n.activeIndex]))return n.pickOption(n.optionsFiltered[n.activeIndex]),void n.$scope.$apply()}n.$scope.$digest()}))}}})).name})(),n.default})()}));
//# sourceMappingURL=angularjs-bootstrap4-extended-select.min.js.map