angular.module("extendedSelect",["angularBS.helpers","angularBS.dropdown"]),function(){"use strict";function e(e){angular.forEach(["ngOptions","select"],function(t){e.decorator(t+"Directive",["$delegate",function(e){return angular.forEach(e,function(e){const t=e.compile||function(){};e.compile=function(n){if("EXTENDED-SELECT"!==n[0].tagName)return t.apply(this,arguments)||e.link}}),e}])})}e.$inject=["$provide"],angular.module("extendedSelect").config(e)}(),function(){"use strict";angular.module("extendedSelect").provider("extendedSelect",function(){this.options={placeholder:" ",placeholderMultiple:" ",typeToSearch:0,typeToSearchText:"Zacznij pisać, by wyświetlić dostępne opcje",addOptionLang:"Dodaj",loadMoreResultsLang:"Pobierz więcej wyników",searchByValue:!1},this.$get=function(){return this.options}})}(),function(){"use strict";angular.module("extendedSelect").directive("esTransclude",function(){return{restrict:"A",require:"^extendedSelect",link:function(e,t,n,l,s){(n.esTransclude?[n.esTransclude]:["optionTemplate","beforeOption"]).forEach(n=>{s.isSlotFilled(n)&&s((s,i)=>{i.$extendedSelect=l,i.$option=e.o,i.$isOption=!0,angular.isUndefined(e.o)&&(i.$isOption=!1,l.multiple?i.$option={value:e.m,label:l.getModelLabel(e.m)}:i.$watch(()=>l.ngModel,()=>{i.$option={value:l.ngModel,label:l.getModelLabel()}})),"optionTemplate"===n?t.contents().replaceWith(s):t.prepend(s)},null,n)})}}})}(),function(){"use strict";function e(e){const t=this;function n(){t._search=t.extendedSelect.search;let n=t.label;t.label&&angular.isString(t._search)&&t._search.length&&(n=t.label.replace(new RegExp("("+t._search+")","gi"),"<u>$1</u>")),e.html(n)}t.$doCheck=function(){t.extendedSelect.search!==t._search&&n()},t.$onChanges=function(){n()}}e.$inject=["$element"],angular.module("extendedSelect").component("extendedSelectMarkResult",{require:{extendedSelect:"^extendedSelect"},bindings:{label:"<"},controllerAs:"vm",controller:e})}(),function(){"use strict";angular.module("extendedSelect").component("extendedSelectOptionGroup",{controller:class{$onChanges(){this.groups=[this.group];let e=this.group;for(;angular.isDefined(e.parent);){if(e=e.parent,angular.isDefined(this.prevGroup)){let t=this.prevGroup;if(t.level>e.level&&(t=this.getUntilLevel(t,e.level)),t.name===e.name)break}this.groups.unshift(e)}}getUntilLevel(e,t){for(;e.level>t;)e=e.parent;return e}},controllerAs:"vm",bindings:{group:"<",prevGroup:"<"},template:'<h6 class="dropdown-header" ng-repeat="group in vm.groups" ng-style="::{\'padding-left\': 10 + (group.level * 10) + \'px\'}">{{::group.name}}</h6>'})}(),function(){"use strict";angular.module("extendedSelect").directive("extendedSelectOptions",function(){return{restrict:"A",bindToController:{activeIndex:"<extendedSelectOptions"},controller:["$element","angularBS",function(e,t){const n=this;n.$onChanges=function(){const l=e[0].querySelector(`.dropdown-item:nth-child(${n.activeIndex+1})`);if(null===l)return;const s=l.offsetTop,i=e[0].scrollTop,a=t.offset(l).height+s,o=t.offset(e[0]).height;i-s>0?e[0].scrollTop=s:i-a<-1*o&&(e[0].scrollTop=a-o)}}]}})}(),function(){"use strict";function e(e){return{restrict:"A",require:"^extendedSelect",link:function(t,n,l,s){e.has("$animate")&&e.get("$animate").enabled(n,!1),n[0].focus(),n.on("keydown",function(e){if(e.stopPropagation(),!s.optionsFiltered.length)return void(13===e.which&&(s.addOptionAction(),s.$scope.$apply()));const t=s.activeIndex;switch(e.which){case 40:do{if(s.activeIndex++,s.activeIndex>=s.optionsFiltered.length){s.activeIndex=t;break}}while(s.multiple&&s.isSelected(s.optionsFiltered[s.activeIndex]));break;case 38:do{if(s.activeIndex--,s.activeIndex<0){s.activeIndex=t;break}}while(s.multiple&&s.isSelected(s.optionsFiltered[s.activeIndex]));break;case 13:if(angular.isDefined(s.optionsFiltered[s.activeIndex]))return s.pickOption(s.optionsFiltered[s.activeIndex]),void s.$scope.$apply()}s.$scope.$digest()})}}}e.$inject=["$injector"],angular.module("extendedSelect").directive("extendedSelectSearch",e)}(),function(){"use strict";class e{constructor(e,t,n,l,s,i,a){this.$element=e,this.$attrs=t,this.$scope=n,this.$timeout=l,this.$transclude=s,this.extendedSelectOptions=i,this.extendedSelect=a,this._ngOptions="ngOptions"in t?i.parseNgOptions(t.ngOptions):null,this._searchTimeout=null}$onInit(){this.options=[],this.optionsFiltered=[],this.activeIndex=-1,this.search="",this.multiple="multiple"in this.$attrs,!this.deselectable&&"deselectable"in this.$attrs&&!this.$attrs.deselectable.length&&(this.deselectable=!0),this.addOptionLang=this.extendedSelect.addOptionLang,this.loadMoreResultsLang=this.extendedSelect.loadMoreResultsLang,this.typeToSearchText=this.extendedSelect.typeToSearchText,angular.isUndefined(this.typeToSearch)&&(this.typeToSearch=this.extendedSelect.typeToSearch),angular.isUndefined(this.searchByValue)&&(this.searchByValue=this.extendedSelect.searchByValue),angular.isUndefined(this.placeholder)&&(this.placeholder="multiple"in this.$attrs?this.extendedSelect.placeholderMultiple:this.extendedSelect.placeholder),this.multiple&&(this.ngModelCtrl.$isEmpty=function(e){return!e||0===e.length}),this._transcludedOptions=[],this.$transclude(e=>{angular.forEach(e,e=>{this._transcludedOptions.push({value:e.value,label:e.textContent})})},null,"option"),this.$attrs.$observe("placeholder",e=>{this.placeholder=e}),this.$attrs.$observe("disabled",e=>{this.isDisabled=!0===e||angular.isString(e)}),this.$attrs.$observe("readonly",e=>{this.isReadonly=!0===e||angular.isString(e)})}$doCheck(){if(this.isSmall=this.$element.hasClass("custom-select-sm"),this.isLarge=this.$element.hasClass("custom-select-lg"),null!==this._ngOptions){const e=this._ngOptions.valuesFn(this.$scope.$parent);angular.isDefined(e)&&!angular.equals(e,this._optionObjects)&&(this._optionObjects=angular.copy(e),this.updateOptions(e))}}updateOptions(e){const t=angular.copy(this._transcludedOptions),n=[],l=[],s=(e,t)=>{angular.isDefined(t)&&s(t);let l=n.find(t=>t.name===e);return angular.isUndefined(l)?(l={name:e,parentGroup:t,children:[]},n.push(l)):angular.isDefined(t)&&l.parentGroup!==t&&(l.parentGroup=t),l};let i;if(e.forEach((e,n)=>{const l=this._ngOptions.getLocals(n,e),a=this._ngOptions.groupByFn(this.$scope.$parent,l),o=this._ngOptions.nestedByFn(this.$scope.$parent,l);t.push({value:this._ngOptions.valueFn(this.$scope.$parent,l),label:this._ngOptions.displayFn(this.$scope.$parent,l),group:angular.isDefined(a)?s(a,o):void 0}),this._addOptionCalled&&t[t.length-1].label===this.search&&(i=t[t.length-1],this._addOptionCalled=!1)}),n.length){n.forEach(e=>{let t,s;s=angular.isUndefined(e.parentGroup)?l:(t=n.find(t=>t.name===e.parentGroup)).children,e.parent=t,s.push(e)});const e=[],s=(t,n=0)=>{t.forEach(t=>{e.push(t.name),t.level=n,s(t.children,n+1)})};s(l),t.sort((t,n)=>e.indexOf(t.group.name)-e.indexOf(n.group.name))}this.options=t,i&&this.pickOption(i),this.filterData()}open(){const e=this.isOpen;this.ngModelCtrl.$setTouched(),this.isDisabled||this.isReadonly?this.isOpen=!1:this.isOpen=!!this.multiple||!this.isOpen,!e&&this.isOpen&&(this.search="",this.activeIndex=-1,this.options.some((e,t)=>{if(this.isSelected(e)&&(this.activeIndex=t,!this.multiple))return!0}),this.filterData())}_updateMultipleModel(e,t){const n=[];this.options.forEach(l=>{!this.isSelected(l)&&!angular.equals(l.value,e)||angular.equals(l.value,t)||n.includes(l.value)||n.push(l.value)}),angular.equals(this.ngModel,n)||(this.ngModel=n)}filterData(){if(angular.isUndefined(this.search))return void angular.copy(this.options,this.optionsFiltered);if(angular.copy([],this.optionsFiltered),this.search.length<this.typeToSearch)return;const e=this.search.toLowerCase();this.options.forEach(t=>{(t.label.toLowerCase().includes(e)||this.searchByValue&&(angular.isString(t.value)&&t.value.toLowerCase().includes(e)||angular.isObject(t.value)&&angular.toJson(t.value).toLowerCase().includes(e)))&&this.optionsFiltered.push(t)})}isSelected(e){return!angular.isUndefined(this.ngModel)&&(this.multiple?!!~this.ngModel.indexOf(e.value):angular.equals(e.value,this.ngModel))}getModelLabel(e){angular.isUndefined(e)&&(e=this.ngModel);const t=this.options.find(t=>angular.equals(t.value,e));return t?t.label:""}searchFn(e){if(angular.isUndefined(e)&&(this.activeIndex=this.options.length?0:-1),this.hasNextPage=!1,this.filterData(),angular.isFunction(this.resolveOnSearch)&&(this.page=e||1,angular.isDefined(this.search)&&this.search.length)){const e=angular.isUndefined(this._lastSearchValue)?0:750;null!==this._searchTimeout&&this.$timeout.cancel(this._searchTimeout),this._lastSearchValue=this.search,this.loading=!0,this._searchTimeout=this.$timeout(()=>{this._searchTimeout=null,this.resolveOnSearch({value:this.search,page:this.page}).then(e=>{this._lastSearchValue=void 0,this.loading=!1,this.hasNextPage=e&&!!e.hasNextPage,this.filterData()}).catch(angular.noop)},e)}}pickOption(e){this.multiple?(angular.isUndefined(this.ngModel)&&(this.ngModel=[]),~this.ngModel.indexOf(e.value)||this._updateMultipleModel(e.value),this.activeIndex=-1,this.search=""):(this.isOpen=!1,this.ngModel=e.value,this.activeIndex=this.options.indexOf(e)),this.hasNextPage=!1,this.ngModelCtrl.$setViewValue(this.ngModel)}deselect(e){this.multiple?this._updateMultipleModel(void 0,e):this.ngModel=void 0,this.activeIndex=-1,this.ngModelCtrl.$setViewValue(this.ngModel)}addOptionAction(){if(angular.isFunction(this.addOption)&&this.search.length){const e=this.options.find(e=>e.label===this.search);e?this.pickOption(e):(this.addOption({value:this.search}),this._addOptionCalled=!0)}}}e.$inject=["$element","$attrs","$scope","$timeout","$transclude","extendedSelectOptions","extendedSelect"],angular.module("extendedSelect").component("extendedSelect",{require:{ngModelCtrl:"ngModel"},bindings:{ngModel:"=",addOption:"&?",resolveOnSearch:"&?",deselectable:"<?",typeToSearch:"<?",searchByValue:"<?"},transclude:{option:"?option",beforeOption:"?beforeOption",optionTemplate:"?optionTemplate"},templateUrl:"src/templates/extended-select.html",controllerAs:"ctrl",controller:e})}(),function(){"use strict";t.$inject=["$parse"];const e=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?)(?:\s+nested\s+by\s+([\s\S]+?))?)?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([$\w][$\w]*)|(?:\(\s*([$\w][$\w]*)\s*,\s*([$\w][$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/;function t(t){return{parseNgOptions:function(n){const l=n.match(e);if(null===l)return null;const s=l[6]||l[8],i=l[7];return{valueFn:t(l[2]?l[1]:s),displayFn:t(l[2]||l[1]),groupByFn:t(l[3]||""),nestedByFn:t(l[4]||""),valuesFn:t(l[9]),getLocals:function(e,t){const n={};return n[s]=t,i&&(n[i]=e),n}}}}}angular.module("extendedSelect").factory("extendedSelectOptions",t)}(),angular.module("extendedSelect").run(["$templateCache",function(e){e.put("src/templates/extended-select.html",'<div class="dropdown custom-select angular-extended-select" bs-dropdown="ctrl.isOpen" ng-click="ctrl.open()" ng-class="{\'custom-select-sm\': ctrl.isSmall, \'custom-select-lg\': ctrl.isLarge}" ng-disabled="ctrl.isDisabled" ng-readonly="ctrl.isReadonly"><div class="d-flex flex-row-reverse align-items-center" ng-if="::!ctrl.multiple"><div class="d-flex"><div ng-show="ctrl.loading" class="flex-fill pl-1"><i class="fa fa-spinner fa-spin"></i></div><a class="text-success flex-fill pl-1" ng-click="$event.stopPropagation();ctrl.addOptionAction()" ng-if="ctrl.addOption && ctrl.search" title="{{::ctrl.addOptionLang}}"><i class="fa fa-plus"></i></a> <a class="text-danger flex-fill pl-1" ng-click="ctrl.deselect()" ng-if="ctrl.deselectable && ctrl.getModelLabel() && !ctrl.isDisabled && !ctrl.isReadonly"><i class="fa fa-times"></i></a></div><div class="d-flex flex-grow-1 align-items-center" es-transclude="beforeOption"><div ng-show="!ctrl.isOpen" class="text-nowrap" ng-switch="ctrl.ngModelCtrl.$isEmpty(ctrl.ngModel)"><span ng-switch-when="true" class="text-nowrap placeholder">{{ctrl.placeholder}}</span> <span ng-switch-default es-transclude="optionTemplate">{{ctrl.getModelLabel()}}</span></div><input ng-if="ctrl.isOpen" class="flex-grow-1" type="text" ng-model="ctrl.search" ng-change="ctrl.searchFn()" placeholder="{{ctrl.getModelLabel() || ctrl.placeholder}}" extended-select-search></div></div><div class="d-flex flex-row-reverse align-items-center" ng-if="::ctrl.multiple"><div class="d-flex"><div ng-show="ctrl.loading" class="flex-fill pl-1"><i class="fa fa-spinner fa-spin"></i></div></div><div class="d-flex flex-grow-1 flex-wrap"><div ng-if="!ctrl.ngModel.length && !ctrl.isOpen" class="text-nowrap placeholder">{{ctrl.placeholder}}</div><div class="d-flex extended-select-choice" ng-repeat="m in ctrl.ngModel" ng-if="ctrl.getModelLabel(m)"><span class="d-flex" es-transclude>{{::ctrl.getModelLabel(m)}}</span> <button type="button" class="close pl-1" ng-click="$event.stopPropagation();ctrl.deselect(m)" ng-if="!ctrl.isDisabled && !ctrl.isReadonly"><i class="fa fa-times"></i></button></div><input ng-if="ctrl.isOpen" class="flex-grow-1" type="text" ng-model="ctrl.search" ng-change="ctrl.searchFn()" placeholder="{{ctrl.ngModel.length ? \'\': ctrl.placeholder}}" extended-select-search> <a class="text-success" ng-click="$event.stopPropagation();ctrl.addOptionAction()" ng-if="ctrl.addOption && ctrl.search" title="{{::ctrl.addOptionLang}}"><i class="fa fa-plus"></i></a></div></div><div class="dropdown-menu" ng-click="$event.stopPropagation()" ng-hide="!ctrl.typeToSearch && !ctrl.options.length" extended-select-options="ctrl.activeIndex"><div ng-repeat="o in ctrl.optionsFiltered"><extended-select-option-group group="o.group" prev-group="ctrl.optionsFiltered[$index - 1].group" ng-if="o.group && ($first || ctrl.optionsFiltered[$index - 1].group !== o.group)"></extended-select-option-group><a href="javascript:" class="dropdown-item d-flex align-items-center" ng-style="::o.group ? {\'padding-left\': 10 + ((o.group.level + 1) * 10) + \'px\'} : {}" ng-click="ctrl.pickOption(o)" ng-class="{active: $index == ctrl.activeIndex, selected: ctrl.isSelected(o)}" es-transclude><extended-select-mark-result label="o.label"></extended-select-mark-result></a></div><span class="dropdown-item-text" ng-show="ctrl.typeToSearch && ctrl.search.length < ctrl.typeToSearch">{{::ctrl.typeToSearchText}}</span> <a href="javascript:" class="dropdown-item text-primary" ng-show="ctrl.resolveOnSearch && ctrl.hasNextPage && (!ctrl.typeToSearch || ctrl.search.length >= ctrl.typeToSearch)" ng-click="ctrl.searchFn(ctrl.page + 1)">{{::ctrl.loadMoreResultsLang}}</a></div></div>')}]);
//# sourceMappingURL=angularjs-bootstrap4-extended-select.min.js.map
