angular.module("extendedSelect",["angularBS.helpers","angularBS.dropdown"]),function(){"use strict";function e(e){angular.forEach(["ngOptions","select"],function(t){e.decorator(t+"Directive",["$delegate",function(e){return angular.forEach(e,function(e){const t=e.compile||function(){};e.compile=function(i){if("EXTENDED-SELECT"!==i[0].tagName)return t.apply(this,arguments)||e.link}}),e}])})}e.$inject=["$provide"],angular.module("extendedSelect").config(e)}(),function(){"use strict";angular.module("extendedSelect").provider("extendedSelect",function(){this.options={placeholder:" ",placeholderMultiple:" ",typeToSearch:0,typeToSearchText:"Zacznij pisać, by wyświetlić dostępne opcje",addOptionLang:"Dodaj",loadMoreResultsLang:"Pobierz więcej wyników",searchByValue:!1},this.$get=function(){return this.options}})}(),function(){"use strict";function e(e){this.$doCheck=function(){if(this.extendedSelect.search!==this._search){this._search=this.extendedSelect.search;let t=this.label;angular.isString(this._search)&&this._search.length&&(t=this.label.replace(new RegExp("("+this._search+")","gi"),"<u>$1</u>")),e.html(t)}}}e.$inject=["$element"],angular.module("extendedSelect").component("extendedSelectMarkResult",{require:{extendedSelect:"^extendedSelect"},bindings:{label:"<"},controllerAs:"vm",controller:e})}(),function(){"use strict";angular.module("extendedSelect").directive("extendedSelectOption",function(){return{restrict:"A",require:"^extendedSelect",link:function(e,t,i,l,s){s.isSlotFilled("beforeOption")&&s((i,s)=>{s.$extendedSelect=l,s.$option=e.o,s.$isOption=!0,angular.isUndefined(e.o)&&(s.$isOption=!1,l.multiple?s.$option={value:e.m,label:l.getModelLabel(e.m)}:s.$watch(()=>l.ngModel,()=>{s.$option={value:l.ngModel,label:l.getModelLabel()}})),t.prepend(i)},null,"beforeOption")}}})}(),function(){"use strict";angular.module("extendedSelect").directive("extendedSelectOptions",function(){return{restrict:"A",bindToController:{activeIndex:"<extendedSelectOptions"},controller:["$element","angularBS",function(e,t){const i=this;i.$onChanges=function(){const l=e[0].querySelector(`.dropdown-item:nth-child(${i.activeIndex+1})`);if(null===l)return;const s=l.offsetTop,n=e[0].scrollTop,a=t.offset(l).height+s,c=t.offset(e[0]).height;n-s>0?e[0].scrollTop=s:n-a<-1*c&&(e[0].scrollTop=a-c)}}]}})}(),function(){"use strict";function e(e){return{restrict:"A",require:"^extendedSelect",link:function(t,i,l,s){e.has("$animate")&&e.get("$animate").enabled(i,!1),s.searchElement=i,i.on("keydown",function(e){if(e.stopPropagation(),!s.optionsFiltered.length)return void(13===e.which&&(s.addOptionAction(),t.$apply()));const i=s.activeIndex;switch(e.which){case 40:do{if(s.activeIndex++,s.activeIndex>=s.optionsFiltered.length){s.activeIndex=i;break}}while(s.multiple&&s.isSelected(s.optionsFiltered[s.activeIndex]));break;case 38:do{if(s.activeIndex--,s.activeIndex<0){s.activeIndex=i;break}}while(s.multiple&&s.isSelected(s.optionsFiltered[s.activeIndex]));break;case 13:if(angular.isDefined(s.optionsFiltered[s.activeIndex]))return s.pickOption(s.optionsFiltered[s.activeIndex]),void t.$parent.$apply()}t.$parent.$digest()})}}}e.$inject=["$injector"],angular.module("extendedSelect").directive("extendedSelectSearch",e)}(),function(){"use strict";class e{constructor(e,t,i,l,s,n,a){this.$element=e,this.$attrs=t,this.$scope=i,this.$timeout=l,this.$transclude=s,this.extendedSelectOptions=n,this.extendedSelect=a,this._ngOptions="ngOptions"in t?n.parseNgOptions(t.ngOptions):null,this._searchTimeout=null}$onInit(){this.options=[],this.optionsFiltered=[],this.activeIndex=-1,this.search="",this.multiple="multiple"in this.$attrs,!this.deselectable&&"deselectable"in this.$attrs&&!this.$attrs.deselectable.length&&(this.deselectable=!0),this.addOptionLang=this.extendedSelect.addOptionLang,this.loadMoreResultsLang=this.extendedSelect.loadMoreResultsLang,this.typeToSearchText=this.extendedSelect.typeToSearchText,angular.isUndefined(this.typeToSearch)&&(this.typeToSearch=this.extendedSelect.typeToSearch),angular.isUndefined(this.searchByValue)&&(this.searchByValue=this.extendedSelect.searchByValue),angular.isUndefined(this.placeholder)&&(this.placeholder="multiple"in this.$attrs?this.extendedSelect.placeholderMultiple:this.extendedSelect.placeholder),this.multiple&&(this.ngModelCtrl.$isEmpty=function(e){return!e||0===e.length}),this.$attrs.$observe("placeholder",e=>{this.placeholder=e}),this.$attrs.$observe("disabled",e=>{this.isDisabled=!0===e||angular.isString(e)}),this.$attrs.$observe("readonly",e=>{this.isReadonly=!0===e||angular.isString(e)}),this.$element.on("click",()=>{const e=this.isOpen;this.ngModelCtrl.$setTouched(),this.isDisabled||this.isReadonly?this.isOpen=!1:this.isOpen=!!this.multiple||!this.isOpen,!e&&this.isOpen&&(this.search="",this.activeIndex=-1,this.options.some((e,t)=>{if(this.isSelected(e)&&(this.activeIndex=t,!this.multiple))return!0}),this.filterData()),this.$scope.$digest(),!e&&this.isOpen&&this.searchElement[0].focus()})}$doCheck(){const e=[];let t;if(this.$transclude(t=>{angular.forEach(t,t=>{e.push({value:t.value,label:t.textContent})})},null,"option"),null!==this._ngOptions){this._ngOptions.valuesFn(this.$scope.$parent).forEach((i,l)=>{const s=this._ngOptions.getLocals(l,i);e.push({value:this._ngOptions.valueFn(this.$scope.$parent,s),label:this._ngOptions.displayFn(this.$scope.$parent,s)}),this._addOptionCalled&&e[e.length-1].label===this.search&&(t=e[e.length-1],this._addOptionCalled=!1)})}angular.equals(e,this.options)||(this.options=e,t&&this.pickOption(t),this.filterData()),this.isSmall=this.$element.hasClass("custom-select-sm"),this.isLarge=this.$element.hasClass("custom-select-lg")}_updateMultipleModel(e,t){const i=[];this.options.forEach(l=>{!this.isSelected(l)&&!angular.equals(l.value,e)||angular.equals(l.value,t)||i.push(l.value)}),angular.equals(this.ngModel,i)||(this.ngModel=i)}filterData(){if(angular.isUndefined(this.search))return void angular.copy(this.options,this.optionsFiltered);if(angular.copy([],this.optionsFiltered),this.search.length<this.typeToSearch)return;const e=this.search.toLowerCase();this.options.forEach(t=>{(~t.label.toLowerCase().indexOf(e)||this.searchByValue&&~t.value.toLowerCase().indexOf(e))&&this.optionsFiltered.push(t)})}isSelected(e){return!angular.isUndefined(this.ngModel)&&(this.multiple?!!~this.ngModel.indexOf(e.value):angular.equals(e.value,this.ngModel))}getModelLabel(e){angular.isUndefined(e)&&(e=this.ngModel);const t=this.options.find(t=>angular.equals(t.value,e));return t?t.label:""}searchFn(e){if(angular.isUndefined(e)&&(this.activeIndex=this.options.length?0:-1),this.hasNextPage=!1,this.filterData(),angular.isFunction(this.resolveOnSearch)&&(this.page=e||1,angular.isDefined(this.search)&&this.search.length)){const e=angular.isUndefined(this._lastSearchValue)?0:750;null!==this._searchTimeout&&this.$timeout.cancel(this._searchTimeout),this._lastSearchValue=this.search,this.loading=!0,this._searchTimeout=this.$timeout(()=>{this._searchTimeout=null,this.resolveOnSearch({value:this.search,page:this.page}).then(e=>{this._lastSearchValue=void 0,this.loading=!1,this.hasNextPage=e&&!!e.hasNextPage,this.filterData()}).catch(angular.noop)},e)}}pickOption(e){this.multiple?(angular.isUndefined(this.ngModel)&&(this.ngModel=[]),~this.ngModel.indexOf(e.value)||this._updateMultipleModel(e.value),this.activeIndex=-1,this.search=""):(this.isOpen=!1,this.ngModel=e.value,this.activeIndex=this.options.indexOf(e)),this.hasNextPage=!1,this.ngModelCtrl.$setViewValue(this.ngModel)}deselect(e){this.multiple?this._updateMultipleModel(void 0,e):this.ngModel=void 0,this.activeIndex=-1,this.ngModelCtrl.$setViewValue(this.ngModel)}addOptionAction(){if(angular.isFunction(this.addOption)&&this.search.length){const e=this.options.find(e=>e.label===this.search);e?this.pickOption(e):(this.addOption({value:this.search}),this._addOptionCalled=!0)}}}e.$inject=["$element","$attrs","$scope","$timeout","$transclude","extendedSelectOptions","extendedSelect"],angular.module("extendedSelect").component("extendedSelect",{require:{ngModelCtrl:"ngModel"},bindings:{ngModel:"=",addOption:"&?",resolveOnSearch:"&?",deselectable:"<?",typeToSearch:"<?",searchByValue:"<?"},transclude:{option:"?option",beforeOption:"?beforeOption"},templateUrl:"src/templates/extended-select.html",controllerAs:"ctrl",controller:e})}(),function(){"use strict";t.$inject=["$parse"];const e=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([$\w][$\w]*)|(?:\(\s*([$\w][$\w]*)\s*,\s*([$\w][$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/;function t(t){return{parseNgOptions:function(i){const l=i.match(e);if(null===l)return null;const s=l[5]||l[7],n=l[6];return{valueFn:t(l[2]?l[1]:s),displayFn:t(l[2]||l[1]),valuesFn:t(l[8]),getLocals:function(e,t){const i={};return i[s]=t,n&&(i[n]=e),i}}}}}angular.module("extendedSelect").factory("extendedSelectOptions",t)}(),angular.module("extendedSelect").run(["$templateCache",function(e){e.put("src/templates/extended-select.html",'<div class="dropdown custom-select angular-extended-select" bs-dropdown="ctrl.isOpen" ng-class="{\'custom-select-sm\': ctrl.isSmall, \'custom-select-lg\': ctrl.isLarge}" ng-disabled="ctrl.isDisabled" ng-readonly="ctrl.isReadonly"><div class="d-flex flex-row-reverse align-items-center" ng-if="::!ctrl.multiple"><div class="d-flex"><div ng-show="ctrl.loading" class="flex-fill pl-1"><i class="fa fa-spinner fa-spin"></i></div><a class="text-success flex-fill pl-1" ng-click="$event.stopPropagation();ctrl.addOptionAction()" ng-if="ctrl.addOption && ctrl.search" title="{{::ctrl.addOptionLang}}"><i class="fa fa-plus"></i></a> <a class="text-danger flex-fill pl-1" ng-click="ctrl.deselect()" ng-if="ctrl.deselectable && ctrl.getModelLabel() && !ctrl.isDisabled && !ctrl.isReadonly"><i class="fa fa-times"></i></a></div><div class="d-flex flex-grow-1 align-items-center" extended-select-option><div ng-show="!ctrl.isOpen" class="text-nowrap" ng-class="{placeholder: !ctrl.ngModel}">{{ctrl.getModelLabel() || ctrl.placeholder}}</div><input ng-show="ctrl.isOpen" class="flex-grow-1" type="text" ng-model="ctrl.search" ng-change="ctrl.searchFn()" placeholder="{{ctrl.getModelLabel() || ctrl.placeholder}}" extended-select-search></div></div><div class="d-flex flex-row-reverse align-items-center" ng-if="::ctrl.multiple"><div class="d-flex"><div ng-show="ctrl.loading" class="flex-fill pl-1"><i class="fa fa-spinner fa-spin"></i></div></div><div class="d-flex flex-grow-1 flex-wrap"><div ng-show="!ctrl.ngModel.length && !ctrl.isOpen" class="text-nowrap placeholder">{{ctrl.placeholder}}</div><div class="d-flex extended-select-choice" ng-repeat="m in ctrl.ngModel" ng-if="ctrl.getModelLabel(m)"><span class="d-flex" extended-select-option>{{::ctrl.getModelLabel(m)}}</span> <button type="button" class="close pl-1" ng-click="$event.stopPropagation();ctrl.deselect(m)" ng-if="!ctrl.isDisabled && !ctrl.isReadonly"><i class="fa fa-times"></i></button></div><input ng-show="ctrl.isOpen" class="flex-grow-1" type="text" ng-model="ctrl.search" ng-change="ctrl.searchFn()" placeholder="{{ctrl.ngModel.length ? \'\': ctrl.placeholder}}" extended-select-search> <a class="text-success" ng-click="$event.stopPropagation();ctrl.addOptionAction()" ng-if="ctrl.addOption && ctrl.search" title="{{::ctrl.addOptionLang}}"><i class="fa fa-plus"></i></a></div></div><div class="dropdown-menu" ng-click="$event.stopPropagation()" ng-hide="!ctrl.typeToSearch && !ctrl.options.length" extended-select-options="ctrl.activeIndex"><a href="javascript:" class="dropdown-item d-flex align-items-center" ng-repeat="o in ctrl.optionsFiltered" ng-click="ctrl.pickOption(o)" ng-class="{active: $index == ctrl.activeIndex, selected: ctrl.isSelected(o)}" extended-select-option><extended-select-mark-result label="o.label"></extended-select-mark-result></a> <span class="dropdown-item-text" ng-show="ctrl.typeToSearch && ctrl.search.length < ctrl.typeToSearch">{{::ctrl.typeToSearchText}}</span> <a href="javascript:" class="dropdown-item text-primary" ng-show="ctrl.resolveOnSearch && ctrl.hasNextPage && (!ctrl.typeToSearch || ctrl.search.length >= ctrl.typeToSearch)" ng-click="ctrl.searchFn(ctrl.page + 1)">{{::ctrl.loadMoreResultsLang}}</a></div></div>')}]);
//# sourceMappingURL=angularjs-bootstrap4-extended-select.min.js.map
